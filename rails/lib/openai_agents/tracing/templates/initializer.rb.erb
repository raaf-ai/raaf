# frozen_string_literal: true

# OpenAI Agents Tracing Configuration
#
# This file configures the OpenAI Agents tracing system for Rails integration.
# Traces and spans will be stored in your Rails database and viewable at <%= options[:mount_path] %>.

OpenAIAgents::Tracing.configure do |config|
  # Auto-configure the ActiveRecord processor
  # Set to true to automatically start storing traces in the database
  config.auto_configure = true

  # Mount path for the web interface
  config.mount_path = '<%= options[:mount_path] %>'

  # Data retention policy (in days)
  # Traces older than this will be automatically cleaned up
  config.retention_days = 30

  # Sampling rate (0.0 to 1.0)
  # Set to 1.0 to capture all traces, 0.5 for 50%, etc.
  config.sampling_rate = 1.0
end

# Manual processor configuration (alternative to auto_configure)
# Uncomment these lines if you prefer manual setup:
#
# Rails.application.config.after_initialize do
#   OpenAIAgents.tracer.add_processor(
#     OpenAIAgents::Tracing::ActiveRecordProcessor.new
#   )
# end

# Optional: Set up automatic cleanup job
# Uncomment to enable daily cleanup of old traces:
#
# if defined?(ActiveJob)
#   class OpenAIAgentsTracingCleanupJob < ApplicationJob
#     queue_as :default
# 
#     def perform
#       days = OpenAIAgents::Tracing.configuration.retention_days
#       deleted_count = OpenAIAgents::Tracing::Trace.cleanup_old_traces(older_than: days.days)
#       Rails.logger.info "Cleaned up #{deleted_count} old traces"
#     end
#   end
# 
#   # Schedule cleanup to run daily (requires a job scheduler like sidekiq-cron)
#   # OpenAIAgentsTracingCleanupJob.set(cron: '0 2 * * *').perform_later
# end